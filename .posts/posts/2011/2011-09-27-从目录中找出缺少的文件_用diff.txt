# 从目录中找出缺少的文件 用diff

[tags] bash, gnu/linux,  [/tags]

## 问题
有一个目录下有上万个文件，有数字编号，如：


	/单词录音
	voc1.wav
	voc2.wav
	...
	voc20000.wav
	
按说这个文件夹用该有20000个。但我们发现只有19982个。就是说缺少了18个文件。是哪18个文件呢。需要找出来。怎么办？

眼睛看是太累了。而且开始有同事肉眼找了。找出一些，但找不出全部。

## 我的思路

把目录列表作文文件，一个文件名一行。生成一个文本，一个文件名一行，是全的文件明，比如从1-20000。对比2个文件。


先说处理我们的目录。

1. 生成文件名称列表

	#ls -l > filelist.xt
	
2. 用列删除或者正则替换把filelist.txt修改为每行文件名只保留编号，即，从

	voc1.wav
	voc2.wav
	...
	voc20000.wav

变成

	1
	2
	...
	20000
	
3. 生成一个文件，包含1...20000，一行一个数字。我开始想请同事帮忙用js或者php来实现。后来想到了bash中的seq命令

      #seq 1 20000 > seqlist.txt
   
4. 重新排序一下filelist！因为默认ls出来的结果是按照辞典顺序排列的。因此9这个数字在8999后面。

	$sort -g filelist.txt >filelist.sorted.txt    # -g 是按阿拉伯数字排序
	$ mv filelist.sorted.txt filelist.txt


5. 对比两个文件。filelist.txt码前。：）

	$diff -iEb -I RE filelist.txt seqlist.txt
	
凡是 > 的行，就是seqlist中有，filelist没有的。因此，这些就是缺了录音的单词编号。

diff参数说明；

	$ cat diff.options 
	diff -iEb -I RE 1.txt seq1.txt
	
	 -i  --ignore-case
   	            Ignore case differences in file contents.
	
  	-E  --ignore-tab-expansion
   	             Ignore changes due to tab expansion.
	
  	-b  --ignore-space-change
   	            Ignore changes in the amount of white space.
	
 	-I RE  --ignore-matching-lines=RE
   	            Ignore changes whose lines all match RE.
		    




new things to blog
