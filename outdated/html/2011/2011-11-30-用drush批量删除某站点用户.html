<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>用drush批量删除某站点用户</title>
    <link href="/css/local.css" rel="stylesheet">
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3301463-1']);
    _gaq.push(['_trackPageview']);
   (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script>
    </head>
    <body>
      <h1>用drush批量删除某站点用户</h1>

<p>站点 abcd 有1万多用户，现在我只想保留用户名中有 abcd的用户，其它删除。</p>

<p>不想从数据库中直接删除因为怕有残留数据。决定用drush。</p>

<p>我用的方法：</p>

<p>1、用phpmyadmin导出用户名，</p>

<pre><code>    SELECT name FROM `users`
</code></pre>

<p>2、将上面的结果导出为csv:  users.to.del !! 注意：让英文双引号扩住用户名这在后面很有用</p>

<p>3、去掉csv中用户名含abcd的用户</p>

<pre><code>grep -v abcd users.to.del &gt; users.new
</code></pre>

<p>4、别忘了再去掉管理员帐号，手工编辑 users.new</p>

<p>5、在剩下的每行前面加上 drush ucan </p>

<pre><code>drush @sitename ucan "someusername"
</code></pre>

<p>6、sh uers.new 就可以了。这时候双引号就有作用了。因为在shell中运行，如果你是中文用户名或者用户名有空格，如果不用英文双引号扩住，drush会不正常推出的。英文单引号都不行。</p>

    </body>
    <footer>
    <a href="../">Up    </a>
    <a href="/">Home</a>
    <!-- generated on 2013-01-23 09:56:02 +0800 -->
    </footer>
</html>

