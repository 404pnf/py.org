<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>从目录中找出缺少的文件 用diff</title>
    <link href="/css/local.css" rel="stylesheet">
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3301463-1']);
    _gaq.push(['_trackPageview']);
   (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script>
    </head>
    <body>
      <h1>从目录中找出缺少的文件 用diff</h1>

<p>[tags] bash, gnu/linux,  [/tags]</p>

<h2>问题</h2>
<p>有一个目录下有上万个文件，有数字编号，如：</p>

<pre><code>/单词录音
voc1.wav
voc2.wav
...
voc20000.wav
</code></pre>

<p>按说这个文件夹用该有20000个。但我们发现只有19982个。就是说缺少了18个文件。是哪18个文件呢。需要找出来。怎么办？</p>

<p>眼睛看是太累了。而且开始有同事肉眼找了。找出一些，但找不出全部。</p>

<h2>我的思路</h2>

<p>把目录列表作文文件，一个文件名一行。生成一个文本，一个文件名一行，是全的文件明，比如从1-20000。对比2个文件。</p>

<p>先说处理我们的目录。</p>

<ol>
  <li>
    <p>生成文件名称列表</p>

    <p>#ls -l &gt; filelist.xt</p>
  </li>
  <li>
    <p>用列删除或者正则替换把filelist.txt修改为每行文件名只保留编号，即，从</p>

    <p>voc1.wav
 voc2.wav
 …
 voc20000.wav</p>
  </li>
</ol>

<p>变成</p>

<pre><code>1
2
...
20000
</code></pre>

<ol>
  <li>
    <p>生成一个文件，包含1…20000，一行一个数字。我开始想请同事帮忙用js或者php来实现。后来想到了bash中的seq命令</p>

    <p>#seq 1 20000 &gt; seqlist.txt</p>
  </li>
  <li>
    <p>重新排序一下filelist！因为默认ls出来的结果是按照辞典顺序排列的。因此9这个数字在8999后面。</p>

    <p>$sort -g filelist.txt &gt;filelist.sorted.txt    # -g 是按阿拉伯数字排序
 $ mv filelist.sorted.txt filelist.txt</p>
  </li>
  <li>
    <p>对比两个文件。filelist.txt码前。：）</p>

    <p>$diff -iEb -I RE filelist.txt seqlist.txt</p>
  </li>
</ol>

<p>凡是 &gt; 的行，就是seqlist中有，filelist没有的。因此，这些就是缺了录音的单词编号。</p>

<p>diff参数说明；</p>

<pre><code>$ cat diff.options 
diff -iEb -I RE 1.txt seq1.txt

 -i  --ignore-case
   	            Ignore case differences in file contents.
</code></pre>

  	-E  –ignore-tab-expansion
   	             Ignore changes due to tab expansion.

  	-b  –ignore-space-change
   	            Ignore changes in the amount of white space.

 	-I RE  –ignore-matching-lines=RE
   	            Ignore changes whose lines all match RE.

<p>new things to blog</p>

    </body>
    <footer>
    <a href="../">Up    </a>
    <a href="/">Home</a>
    <!-- generated on 2013-01-23 09:56:01 +0800 -->
    </footer>
</html>

