<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>用sed把调查问卷选择答案中的ABCDE等替换成durpal survey模快中分隔答案的英文分号</title>
    <link href="/css/local.css" rel="stylesheet">
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3301463-1']);
    _gaq.push(['_trackPageview']);
   (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script>
    </head>
    <body>
      <h1>用sed把调查问卷选择答案中的ABCDE等替换成durpal survey模快中分隔答案的英文分号</h1>

<p>用sed把调查问卷选择答案中的ABCDE等替换成durpal survey模快中分隔答案的英文分号</p>

<h2>一句话</h2>

<p>代码是 </p>

<pre><code>  sed  's/[BCDEF]\./\n;/g' 原始文件.txt &gt;过渡文件.txt

  sed 's/A\./\n/g' 过渡文件.txt &gt;结果文件.txt
</code></pre>

<p>分两步。</p>

<h2>解释一下方法</h2>

<p>原始文件，word文件我存成txt才能用sed等工具处理</p>

<hr />

<ol>
  <li>
    <p>您希望《一本杂志》的封面采用什么风格：
A. 实物照片  B. 手绘风格  C. 创意图片  D. 其他（请注明）<strong>__</strong><strong>__</strong></p>
  </li>
  <li>
    <p>您认为《一本杂志》内文版式的图片与文字比例：
A. 合适（5:5）  B. 图太多，文字少（7:3）  C. 图略多于文字（6:4）  D. 图少，文字
多（3:7）</p>
  </li>
  <li>
    <p>您认为《一本杂志》内文版式的文字大小：
A. 合适  B. 字大行疏  C. 字小行密</p>
  </li>
</ol>

<hr />

<table>
  <tbody>
    <tr>
      <td>我用 sed -n ‘s///gp’ 原始文件.txt 或者 我用 sed ‘s///g’ 原始文件.txt</td>
      <td>less 不断查看和调不断查看你的修改结果而不要直接更新或者生成新文件。第一个方法中 -n 先告诉sed不要输出结果，sed默认输出修改后的全文。之后的 gp g是全文替换 p是print那些改变了的行。第2个是保持sed默认的直接输出修改后的全文但用less来查看这样能够翻页而不是一下滚屏到最后你看不清你的命令是否有作用。</td>
    </tr>
  </tbody>
</table>

<p>我们来我分析一下文本。选项是1个英文大写字母后面加一个英文句号（这个相当于分割答案选项的字符），之后是答案选项。我们需要把原分割字符题换成英文分号，我加一个newline也就是\n是为了让结果更好看一点。</p>

<p>经过几次实验，我用</p>

<p>sed  ‘s/[ABCDEFGHIJKLMN]./\n;/g’ 原始文件.txt</p>

<p>效果不错，因为有的题目很多选项所以我一口气写到N。</p>

<p>聪明人该说了，干嘛不用[A-Z]，直接包含26个大写字母了。</p>

<p>聪明！我更新一下 ：）</p>

<pre><code>   sed  's/[A-Z]\./\n;/g' 原始文件.txt &gt; 结果文件.txt
</code></pre>

<p>看看结果：</p>

<pre><code>less 结果文件.txt
</code></pre>

<hr />

<ol>
  <li>您希望《一本杂志》的封面采用什么风格：</li>
</ol>

<p>; 实物照片<br />
; 手绘风格<br />
; 创意图片<br />
; 其他（请注明）<strong>__</strong><strong>__</strong></p>

<ol>
  <li>您认为《一本杂志》内文版式的图片与文字比例：</li>
</ol>

<p>; 合适（5:5）<br />
; 图太多，文字少（7:3）<br />
; 图略多于文字（6:4）<br />
; 图少，文字多（3:7）</p>

<ol>
  <li>您认为《一本杂志》内文版式的文字大小：</li>
</ol>

<p>; 合适<br />
; 字大行疏<br />
; 字小行密</p>

<hr />

<p>熟悉durpal survey module的人会说了，每个选项第一个”;”是多余的。因为它前面没有选项啊？而且会造成每一个题目第一个选项都是空的。你说得对，但如何用sed删除那个我不会。请帮忙。这样已经减少我很多工作量了。我在粘贴进去的时候手工删除。</p>

<p><strong><em>更新</em></strong> 其实只要分两步处理开头是A.和开头不是A.的就可以了。也就是我最终给的那两行代码。先把不是A.开头，是B-Z加一个英文句号的题换成newline加一个英文分号，然后把A.替换成一个newline。完全不需要任何手工修改。：）</p>

<table>
  <tbody>
    <tr>
      <td>还有一个问题，我忘了sed中不去分大小写是什么了。我当然可以用 [a-z].</td>
      <td>[A-Z]. 中间的</td>
      <td>代表或者，用不去分大小写的那个开关应该更方便。</td>
    </tr>
  </tbody>
</table>

<p>现在我有信心这个是我想要的，我可以用 -i 选项直接更新原文件。</p>

<pre><code>   sed  's/[B-Z]\./\n;/g'  -i 原始文件.txt

   sed  's/A\./\n/g'  -i 原始文件.txt
</code></pre>

<p>但别轻易用 -i 除非你 1）还有原文件备份 2）确实看好了命令生成的是你想要的</p>

<h2>后记：</h2>

<p>如果有人能写一个让durpal sruvey module直接导入一个有个是的文本文件生成试题就好了。</p>

<p>比如 </p>

<p>\\\radios \\\question 1. 你喜欢我写的这篇文章么 \\\answer 喜欢; 很喜欢; 特别喜欢</p>

<p>我设想的语法是 \\\ 后面跟格式命令，表示段字串不是正文内容。比如\\\radios表示道题是选择题，显示为radios模式 \\\question 表示它后面跟题干 \\\answer 表示后面跟答案选项。</p>

<p>我也许应该把这个提议发到survey module的feature request上。有能看懂这段中文的朋友愿意帮忙修改这个模块么？</p>

<p>在这里查看这个模块和它的源代码，http://drupal.org/project/survey 该模块自然是自由软件。</p>

    </body>
    <footer>
    <a href="../">Up    </a>
    <a href="/">Home</a>
    <!-- generated on 2013-01-23 09:56:07 +0800 -->
    </footer>
</html>

