<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>用ruby我把平常记笔记的大文件分割为可供jekyll使用的单独post</title>
    <link href="/css/local.css" rel="stylesheet">
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3301463-1']);
    _gaq.push(['_trackPageview']);
   (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script>
    </head>
    <body>
      <h1>用ruby我把平常记笔记的大文件分割为可供jekyll使用的单独post</h1>

<h2>我笔记的文件格式</h2>
<p>就是个文本文件，markdown格式</p>

<pre><code>    # 一篇文章标题
    正文正文正文正文正文正文正文正文正文
    # 又一篇文章
    正文正文正文正文正文正文正文正文
</code></pre>

<p>好处是我随时想写打开这个文本文件可就可以了。现在我需要让程序把它切分为每篇文章一个文件。使用ruby。</p>

<h2>思路：</h2>
<ol>
  <li>打开整个文件</li>
  <li>/^# / 作为分割符 把整个文本差分成数组。遍历数组，每个写成一个文件。</li>
</ol>

<h2>注意问题：</h2>
<ol>
  <li>split方法后，分割符本身从文本中消失了！！！ 因此不能再通过 /^# / 来判断文章标题。因此改用该文件的第一行作为题目。因为之前的 /^# /  这行就是题目，就是第一行</li>
  <li>分割整个文本的数组第一个元素会是 “\n” 。为什么我也不知道。但我现在明白了之前lg给我用php写同样的东西，为什么也总会有一个空文章。可以先用 array.shift 去除它。</li>
</ol>

<h2>代码主要片段：</h2>

<pre><code>    str = IO.read("/home/404/Desktop/xin-biji.txt") # 如果不把文件按字符串一口气读进来，我就不知道如何使用split方法了。
    
    posts = str.split(/^# /)
    
    &gt;&gt; posts[0]
    =&gt; "\n
    
    &gt;&gt; posts.shift
     =&gt; "\n
    
    &gt;&gt; posts[0]
    =&gt; "在jekyll中自定义yaml frontmatter然后在模板中收集这些信息\n\n例子给的是自定义了一个 image: value 的头信息\n---\nlayout: portfolio_entry\ntitle: Road and Curb\nimage: /img/road.jpg\n---\n\n&lt;ul class=\"entries\"&gt;\n  {% for post in site.posts %}\n\n  &lt;li&gt;\n    &lt;a href=\"{{ post.url }}\"&gt;\n      &lt;img src=\"{{ post.image }}\" /&gt;\n      &lt;h3&gt;{{ post.title }}&lt;/h3&gt;\n    &lt;/a&gt;\n  &lt;/li&gt;\n\n  {% endfor %}\n  \nhttp://net.tutsplus.com/tutorials/other/building-static-sites-with-jekyll/\n\n"
</code></pre>

<p>我的问题      <br />
我如何把posts[0]这个字符传分成两部分？
title = 该字符串的第一行，或者说从第一个字符到第一个\n
body = 剩下的那些行
然后我会把它们写成文件：</p>

<p>filename = “#{date}-#{counter}.markdown”
  File.open(“#{filename}”, “w”) do |f|
    f.puts “—”
    f.puts title
    f.puts body
  end</p>

<h2>完整代码：</h2>


    </body>
    <footer>
    <a href="../">Up    </a>
    <a href="/">Home</a>
    <!-- generated on 2013-01-23 09:55:56 +0800 -->
    </footer>
</html>

