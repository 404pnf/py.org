<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ruby中对中文进行按照拼音排序</title>
    <link href="/css/local.css" rel="stylesheet">
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3301463-1']);
    _gaq.push(['_trackPageview']);
   (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script>
    </head>
    <body>
      <h1>ruby中对中文进行按照拼音排序</h1>

<h2>方法就是在排序时候把字符集转为GBK然后ruby可以按拼音排序</h2>

<p>用ruby的 String#encode方法
http://ruby-doc.org/core-1.9.3/String.html#method-i-encode</p>

<pre><code>encode(encoding [, options] ) → str click to toggle source
encode(dst_encoding, src_encoding [, options] ) → str
</code></pre>

<p>把一个中文字符从utf-8转换为GBK，方法是</p>

<pre><code> str.encode("gbk, "utf-8")
</code></pre>

<p>大小写似乎没有区别！</p>

<p>这个拼音排序也是不准确的，因为：</p>

<p>1、有些汉字ruby不知道拼音是什么，排到最后
2、汉字多音字，就看选哪个出来排了</p>

<h2>实际例子</h2>

<pre><code>irb(main):019:0&gt; c
=&gt; ["浙江", "湖南", "安徽", "广东", "重庆"]
irb(main):020:0&gt; c.sort {|x,y| x.encode("GBK", "utf-8") &lt;=&gt; y.encode("GBK", "utf-8")}
=&gt; ["安徽", "广东", "湖南", "浙江", "重庆"]
</code></pre>

<p>看到了么，我们知道重庆念chong2，但它多音字还年重zhong4，因此被排在了最后。</p>

<pre><code> c.sort {|x,y| x.encode("GBK", "utf-8") &lt;=&gt; y.encode("GBK", "utf-8")}
 =&gt; ["安徽", "广东", "湖南", "浙江", "重庆", "鑫"]
</code></pre>

<p>明显输入不忍是鑫xin1，因此排到最后，比Z还靠后。</p>

<h2>有些utf-8是不能转换为gbk的！</h2>

<pre><code>index_generator.rb:18:in `encode': U+200F from UTF-8 to GBK (Encoding::UndefinedConversionError)
</code></pre>

<p>错误信息！</p>

<h2>参考了</h2>

<blockquote>
  <p>用了server/console做了验证
» conv = Iconv.new(“GBK”, “utf-8”)
=&gt; #<iconv:0xb6dc1f70>
&gt;&gt; c=%w(浙江 湖南 安徽 广东)
=&gt; ["浙江", "湖南", "安徽", "广东"]
&gt;&gt; b=c.sort
=&gt; ["安徽", "广东", "浙江", "湖南"]
&gt;&gt; b=c.sort {|x,y| conv.iconv(x) &lt;=&gt; conv.iconv(y)}
=&gt; ["安徽", "广东", "湖南", "浙江"]
恩，现在看来这个方法是可行的
blueteeth —— 2009年04月04日 @10:51 pm
http://blog.donews.com/jenniferweng/archive/2006/08/07/991039.aspx</iconv:0xb6dc1f70></p>
</blockquote>

<p>但是ruby1.9中已经不推荐使用iconv了。</p>


    </body>
    <footer>
    <a href="../">Up    </a>
    <a href="/">Home</a>
    <!-- generated on 2013-01-23 09:55:55 +0800 -->
    </footer>
</html>

