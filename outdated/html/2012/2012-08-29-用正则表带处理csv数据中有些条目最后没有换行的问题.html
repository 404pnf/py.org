<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>用正则表带处理csv数据中有些条目最后没有换行的问题</title>
    <link href="/css/local.css" rel="stylesheet">
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3301463-1']);
    _gaq.push(['_trackPageview']);
   (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
    </script>
    </head>
    <body>
      <h1>用正则表带处理csv数据中有些条目最后没有换行的问题</h1>

<p>某csv文件有问题，应该每一行一条数据，可是有的行结束了，后面没有换行，于是就有了</p>

<pre><code>    "作文正文...","37013""邓祎蕾","奉贤›奉贤中学","高二","2011-11-27","二等奖","融合","处在一个经济发达的城市..."
</code></pre>

<p>注意有两个紧接的英文双引号，应该是中间有换行的。</p>

<p>我需要增加这个换行。但是不能直接 s/””/”\r”/ 因为csv中如果数据内容中有双引号，也会用双引号括起来！！</p>

<p>还好本文有规律，都是数字后面跟着姓名，于是我用下面的方法先查看一下我预估的正则是否匹配正确文本，</p>

<pre><code>    $ grep "[0-9][0-9][0-9]\"\"" posts-zw-2011\ \(1\).csv |wc -l
    365
</code></pre>

<p>是的。</p>

<p>再在vim中替换：</p>

<pre><code>           :%s/\([0-9][0-9][0-9][0-9][0-9]"\)"/\1\r"/

       :%s/\([0-9]{4}-[0-9]{2}-[0-9]{2}"\)"/\1\r"/
       :%s/\([0-9][0-9][0-9][0-9}-[0-9][0-9]-[0-9][0-9]"\)"/\1\r"/c
</code></pre>

<p>vim中作为分组的括号需要escape，且换行是 \r。</p>


    </body>
    <footer>
    <a href="../">Up    </a>
    <a href="/">Home</a>
    <!-- generated on 2013-01-23 09:55:56 +0800 -->
    </footer>
</html>

